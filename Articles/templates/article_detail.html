<!-- templates/articles/article_detail.html -->
{% extends 'layout.html' %}

{% block title %}{{ article.title }} - TheFlipperEconomics{% endblock %}

{% block content %}
    <article class="container my-4">
        <h1 class="mb-3">{{ article.title }}</h1>
	<script type="text/javascript">
	atOptions = {
		'key' : '80be9106c74d29a1f7341d8a906b0f93',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/80be9106c74d29a1f7341d8a906b0f93/invoke.js"></scr' + 'ipt>');
</script>
        <p>Written by Admin on {{ article.pub_date|date:"F d, Y" }}</p>
	    <script type="text/javascript">
	atOptions = {
		'key' : '80be9106c74d29a1f7341d8a906b0f93',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/80be9106c74d29a1f7341d8a906b0f93/invoke.js"></scr' + 'ipt>');
</script>
        
        {% if article.image %}
            <img src="{{ article.image.url }}" alt="{{ article.title }}" class="img-fluid mb-3">
        {% endif %}
	    <script type="text/javascript">
	atOptions = {
		'key' : '80be9106c74d29a1f7341d8a906b0f93',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/80be9106c74d29a1f7341d8a906b0f93/invoke.js"></scr' + 'ipt>');
</script>
        
        <p>{{ article.content|safe }}</p>
	    <script type="text/javascript">
	atOptions = {
		'key' : '80be9106c74d29a1f7341d8a906b0f93',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/80be9106c74d29a1f7341d8a906b0f93/invoke.js"></scr' + 'ipt>');
</script>

        {% if is_last_article %}
            <!-- Display predefined Pcode for the last article -->
            <p class="mb-3"><strong>Pcode:</strong> 12345</p>
        {% endif %}

        <!-- Google AdSense Code -->
        <div class="mb-4">
            <!-- Replace the following code with your actual AdSense ad code -->
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1335840781247344"
     crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1335840781247344"
                 data-ad-slot="7890123456"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        {% if next_article %}
            <div id="nextButtonContainer" style="display: none;">
                <button id="nextButton" class="btn btn-primary">Next</button>
            </div>

            <p id="timerText" style="display: none;">Next article in <span id="timerCountdown"></span> seconds</p>

            <script>
                // Set a timeout for 20 seconds
                const countdownDuration = 20;
                let countdown = countdownDuration;
            
                const timerText = document.getElementById('timerText');
                const timerCountdown = document.getElementById('timerCountdown');
                const nextButtonContainer = document.getElementById('nextButtonContainer');
                const nextButton = document.getElementById('nextButton');
            
                const countdownInterval = setInterval(function () {
                    countdown--;
            
                    // Display the timer text and countdown
                    timerText.style.display = 'block';
                    timerCountdown.innerText = countdown;
            
                    // If the countdown reaches 0, display the "Next" button
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        timerText.style.display = 'none';
                        nextButtonContainer.style.display = 'block';
                    }
                }, 1000);
            
                // Function to handle ad click
                function handleAdClick() {
                    // Perform actions specific to ad click tracking
                    console.log('Ad clicked');
                    // Store the ad click instance in the session
                    sessionStorage.setItem('adClickInstance', 'clicked');
                }

                // Function to handle next button click
                function handleNextButtonClick() {
                    // Redirect to the URL of the next article
                    window.location.href = '{% url 'article_detail' slug=next_article.slug %}';
                }
            
                // Add an event listener to the Next button for redirection
                nextButton.addEventListener('click', function () {
                    handleAdClick();  // Call the function for ad click tracking
                    handleNextButtonClick();  // Call the function for next button click
                });
            </script>
        {% else %}
            <!-- Display message if no next article -->
            {% if not ad_clicked %}
                <p class="mb-3">Pcode:1234567890</p>
            {% endif %}
        {% endif %}
    </article>
{% endblock %}
